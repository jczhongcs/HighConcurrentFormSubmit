<!DOCTYPE html>

<html lang="en">
<head>
  <title>修改用户</title>
  <link rel="stylesheet"  href="/bootstrap/css/styles.css">
  <link rel="stylesheet" href="/bootstrap/css/colors.css">
  <link rel="stylesheet" href="/bootstrap/css/cont.css">
  <!-- jquery -->
  <script type="text/javascript" src="/js/jquery.min.js"></script>
  <!-- bootstrap -->
  <link rel="stylesheet" type="text/css" href="/bootstrap/css/bootstrap.min.css" />
  <script type="text/javascript" src="/bootstrap/js/bootstrap.min.js"></script>
  <!-- jquery-validator -->
  <script type="text/javascript" src="/jquery-validation/jquery.validate.min.js"></script>
  <script type="text/javascript" src="/jquery-validation/localization/messages_zh.min.js"></script>
  <!-- layer -->
  <script type="text/javascript" src="/layer/layer.js"></script>
  <!-- md5.js -->
  <script type="text/javascript" src="/js/md5.min.js"></script>
  <!-- common.js -->
  <script type="text/javascript" src="/js/common.js"></script>
  <script src="/js/popper.min.js"></script>
  <script src="/js/custom.js"></script>
  <script src="/js/moment.min.js"></script>
  <script src="/js/daterangepicker.js"></script>
  <script src="/js/dropzone.js"></script>
  <script src="/js/imagesloaded.js"></script>
  <script src="/js/ion.rangeSlider.min.js"></script>
  <script src="/js/jquery.magnific-popup.min.js"></script>
  <script src="/js/lightbox.js"></script>
  <script src="/js/markerclusterer.js"></script>


  <script src="/js/morris.min.js"></script>
  <script src="/js/raphael.min.js"></script>
  <script src="/js/select2.min.js"></script>
  <script src="/js/slick.js"></script>
  <script src="/js/slider-bg.js"></script>
  <script src="/js/script.js"></script>



</head>
<body onload="initFileds();checking();">
<div th:insert="stuhead.html"></div>
<div class="container-fluid p-0">
  <div class="row">

    <div class="col-lg-3 col-md-4 col-sm-12">
      <div class="property_dashboard_navbar">
        <div class="dash_user_menues">
          <ul>
            <li></li>


            <li></li>
            <li >
              <a href="/stumanage/to_sel" style="color:white">
                <i class="ti-hummer"></i>&nbsp;选择课程
              </a>
            </li>
            <li></li>
            <li >
              <a href="/stumanage/seled_course" style="color:white">
                <i class="ti-gift"></i>&nbsp;已选课程
              </a>
            </li>
            <li></li>
            <li class="active">
              <a href="/stumanage/userinfo" style="color:white">
                <i class="ti-user"></i>&nbsp;个人信息
              </a>
            </li>
            <li></li>
            <li>
              <a href="/stumanage/feedback" style="color:white">
                <i class="ti-email"></i>&nbsp;反馈意见
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>




    <div class="col-lg-9 col-md-8 col-sm-12">
      <section style="padding-top:10px";>
        <div class="container">
          <div class="row">
                  <form id="userForm">

                    <div class="col-lg-12 col-md-12">
                      <div class="submit-page form-simple">
                        <div class="frm_submit_block">
                          <h3>用户信息</h3>
                          <div class="form-row">
                            <div class="form-group col-md-8">
                              <input type="hidden" id="id" name="id" class="form-control" th:value=${user!=null}?${user.id}>
                            </div>


                            <div class="form-group col-md-6">
                              <label>昵称</label>
                              <input type="text" id="nickname" name="nickname" class="form-control" placeholder="昵称" th:value=${user!=null}?${user.nickname}>
                            </div>

                            <div class="form-group col-md-2">
                              <label>性别</label>
                              <select th:field="${user.sex}" class="form-control" name="sex" id="sex">
                                <option th:selected="${user.sex=='男'}" value="1">男</option>
                                <option th:selected="${user.sex=='女'}" value="2" >女</option>
                              </select>
                            </div>

                            <div class="form-group col-md-8">
                              <label>身份证号</label>
                              <input type="text" id="idcard" name="idcard" class="form-control" placeholder="身份证号" th:value=${user!=null}?${user.idcard} >
                            </div>

                            <div class="form-group col-md-8">
                              <label>手机号</label>
                              <input type="text" id="phone" name="phone" class="form-control" placeholder="手机号" th:value=${user!=null}?${user.phone} >
                            </div>

                            <div class="form-group col-md-8">
                              <label>邮箱</label>
                              <input type="text" id="email" name="email" class="form-control" placeholder="邮箱" th:value=${user!=null}?${user.email} >
                            </div>

                            <div class="form-group col-md-8">
                              <label>用户密码</label>
                              <input type="text" id="password" name="password" class="form-control" placeholder="******" >
                            </div>


                            <div class="form-group col-md-6">
                              <label>学历</label>
                              <select th:field="${user.degree}" class="form-control" name="degree" id="degree">
                                <option th:selected="${user.degree=='博士'}" value="博士">博士</option>
                                <option th:selected="${user.degree=='硕士'}" value="硕士">硕士</option>
                                <option th:selected="${user.degree=='本科'}" value="本科">本科</option>
                                <option th:selected="${user.degree=='大专'}" value="大专">大专</option>
                                <option th:selected="${user.degree=='无'}" value="无">无</option>
                              </select>
                            </div>


                            <div th:if="${user.role==1}">
                              <div class="form-group col-md-12">
                                <label>年级</label>
                                <select th:field="${user.grade}" class="form-control" name="grade" id="grade">
                                  <option th:selected="${user.grade=='大一'}" value="大一">大一</option>
                                  <option th:selected="${user.grade=='大二'}" value="大二">大二</option>
                                  <option th:selected="${user.grade=='大三'}" value="大三">大三</option>
                                  <option th:selected="${user.grade=='大四'}" value="大四">大四</option>
                                </select>
                              </div>
                            </div>
                            <div th:if="${user.role==1}">
                              <div class="form-group col-md-12">
                                <label>是否师范生</label>
                                <select th:field="${user.isnormal}" class="form-control" name="isnormal" id="isnormal">
                                  <option th:selected="${user.isnormal=='是'}" value="是">是</option>
                                  <option th:selected="${user.isnormal=='否'}" value="否">否</option>
                                </select>
                              </div>
                            </div>


                            <div class="form-group col-md-4">
                              <label>民族</label>
                              <select th:field="${user.nation}" class="form-control" id="nation" name="nation">
                                <option th:selected="${user.nation=='汉族'}" value="汉族">汉族</option>
                                <option th:selected="${user.nation=='蒙古族'}"  value="蒙古族">蒙古族</option>
                                <option th:selected="${user.nation=='回族'}"  value="回族">回族</option>
                                <option th:selected="${user.nation=='藏族'}"  value="藏族">藏族</option>
                                <option th:selected="${user.nation=='维吾尔族'}"  value="维吾尔族">维吾尔族</option>
                                <option th:selected="${user.nation=='苗族'}"  value="苗族">苗族</option>
                                <option th:selected="${user.nation=='彝族'}"  value="彝族">彝族</option>
                                <option th:selected="${user.nation=='壮族'}"  value="壮族">壮族</option>
                                <option th:selected="${user.nation=='布依族'}"  value="布依族">布依族</option>
                                <option th:selected="${user.nation=='朝鲜族'}"  value="朝鲜族">朝鲜族</option>
                                <option th:selected="${user.nation=='满族'}"  value="满族">满族</option>
                                <option th:selected="${user.nation=='侗族'}"  value="侗族">侗族</option>
                                <option th:selected="${user.nation=='瑶族'}"  value="瑶族">瑶族</option>
                                <option th:selected="${user.nation=='白族'}"  value="白族">白族</option>
                                <option th:selected="${user.nation=='土家族'}"  value="土家族">土家族</option>
                                <option th:selected="${user.nation=='哈尼族'}"  value="哈尼族">哈尼族</option>
                                <option th:selected="${user.nation=='哈萨克族'}"  value="哈萨克族">哈萨克族</option>
                                <option th:selected="${user.nation=='傣族'}"  value="傣族">傣族</option>
                                <option th:selected="${user.nation=='黎族'}"  value="黎族">黎族</option>
                                <option th:selected="${user.nation=='傈僳族'}"  value="傈僳族">傈僳族</option>
                                <option th:selected="${user.nation=='佤族'}"  value="佤族">佤族</option>
                                <option th:selected="${user.nation=='畲族'}"  value="畲族">畲族</option>
                                <option th:selected="${user.nation=='高山族'}"  value="高山族">高山族</option>
                                <option th:selected="${user.nation=='拉祜族'}"  value="拉祜族">拉祜族</option>
                                <option th:selected="${user.nation=='水族'}"  value="水族">水族</option>
                                <option th:selected="${user.nation=='东乡族'}"  value="东乡族">东乡族</option>
                                <option th:selected="${user.nation=='纳西族'}"  value="纳西族">纳西族</option>
                                <option th:selected="${user.nation=='景颇族'}"  value="景颇族">景颇族</option>
                                <option th:selected="${user.nation=='柯尔克孜族'}"  value="柯尔克孜族">柯尔克孜族</option>
                                <option th:selected="${user.nation=='土族'}"  value="土族">土族</option>
                                <option th:selected="${user.nation=='达翰尔族'}"  value="达翰尔族">达翰尔族</option>
                                <option th:selected="${user.nation=='么佬族'}"  value="么佬族">么佬族</option>
                                <option th:selected="${user.nation=='羌族'}"  value="羌族">羌族</option>
                                <option th:selected="${user.nation=='布朗族'}"  value="布朗族">布朗族</option>
                                <option th:selected="${user.nation=='撒拉族'}"  value="撒拉族">撒拉族</option>
                                <option th:selected="${user.nation=='毛南族'}"  value="毛南族">毛南族</option>
                                <option th:selected="${user.nation=='仡佬族'}"  value="仡佬族">仡佬族</option>
                                <option th:selected="${user.nation=='锡伯族'}"  value="锡伯族">锡伯族</option>
                                <option th:selected="${user.nation=='阿昌族'}"  value="阿昌族">阿昌族</option>
                                <option th:selected="${user.nation=='普米族'}"  value="普米族">普米族</option>
                                <option th:selected="${user.nation=='塔吉克族'}"  value="塔吉克族">塔吉克族</option>
                                <option th:selected="${user.nation=='怒族'}"  value="怒族">怒族</option>
                                <option th:selected="${user.nation=='乌孜别克族'}"  value="乌孜别克族">乌孜别克族</option>
                                <option th:selected="${user.nation=='俄罗斯族'}"  value="俄罗斯族">俄罗斯族</option>
                                <option th:selected="${user.nation=='鄂温克族'}"  value="鄂温克族">鄂温克族</option>
                                <option th:selected="${user.nation=='德昂族'}"  value="德昂族">德昂族</option>
                                <option th:selected="${user.nation=='保安族'}"  value="保安族">保安族</option>
                                <option th:selected="${user.nation=='裕固族'}"  value="裕固族">裕固族</option>
                                <option th:selected="${user.nation=='京族'}"  value="京族">京族</option>
                                <option th:selected="${user.nation=='塔塔尔族'}"  value="塔塔尔族">塔塔尔族</option>
                                <option th:selected="${user.nation=='独龙族'}"  value="独龙族">独龙族</option>
                                <option th:selected="${user.nation=='鄂伦春族'}"  value="鄂伦春族">鄂伦春族</option>
                                <option th:selected="${user.nation=='赫哲族'}"  value="赫哲族">赫哲族</option>
                                <option th:selected="${user.nation=='门巴族'}"  value="门巴族">门巴族</option>
                                <option th:selected="${user.nation=='珞巴族'}"  value="珞巴族">珞巴族</option>
                                <option th:selected="${user.nation=='基诺族'}"  value="基诺族">基诺族</option>
                              </select>
                            </div>
                            <div class="form-group col-md-4">
                            <br>
                            </div>

                            <div class="form-group col-md-6">
                              <label>政治面貌</label>
                              <select th:field="${user.politics}" class="form-control" name="politics" id="politics">
                                <option th:selected="${user.politics=='群众'}" value="群众">群众</option>
                                <option th:selected="${user.politics=='团员'}" value="团员">团员</option>
                                <option th:selected="${user.politics=='党员'}" value="党员">党员</option>
                              </select>
                            </div>

                            <div class="form-group col-md-4">
                              <label>籍贯</label>
                              <input type="text" id="ethnic" name="ethnic" class="form-control" placeholder="籍贯" th:value=${user!=null}?${user.ethnic} >
                            </div>

                            <br>
                            <div class="form-group col-md-6">
                              <label>住址</label>
                              <input type="text" id="address" name="address" class="form-control" placeholder="住址" th:value=${user!=null}?${user.address} >
                            </div>


                            <div class="form-group col-md-4">
                              <label>生日</label>

                              <input type="date" id="birthday" name="birthday" class="form-control"  th:value="${#dates.format(user.birthday, 'yyyy-MM-dd')}" >

                            </div>


                            <div class="form-group col-md-12">
                            <br>
                            </div>

                            <div class="form-group col-md-8">
                              <a id="ms1View" class="btn btn-primary" style="color:white" ></i>查看/隐藏监护人1信息</a>
                            </div>


                            <div id="firstMenu" class="firstMenu">

                              <div class="form-group col-md-6">
                              <label>监护人1姓名</label>
                              <input type="text" id="m1Name" name="m1Name" class="form-control"  th:value=${user.m1Name} >
                              </div>


                              <div class="form-group col-md-6">
                                <label>联系手机</label>
                                <input type="text" id="m1Phone" name="m1Phone" class="form-control"  th:value=${user.m1Phone}>
                              </div>

                              <div class="form-group col-md-6">
                                <label>家属关系</label>
                                <select th:field="${user.m1Relate}" class="form-control" name="m1Relate" id="m1Relate">
                                  <option th:selected="${user.m1Relate=='父子'}" value="父子">父子</option>
                                  <option th:selected="${user.m1Relate=='母子'}" value="母子">母子</option>
                                  <option th:selected="${user.m1Relate=='祖孙'}" value="祖孙">祖孙</option>
                                </select>
                              </div>
                            </div>
                            <div class="form-group col-md-8">
                              <a id="ms2View" class="btn btn-primary" style="color:white" ></i>查看/隐藏监护人2信息</a>
                            </div>
                            <div id="secondMenu" class="secondMenu">

                              <div class="form-group col-md-6">
                                <label>监护人2姓名</label>
                                <input type="text" id="m2Name" name="m2Name" class="form-control"  th:value=${user.m2Name} >
                              </div>


                              <div class="form-group col-md-6">
                                <label>联系手机</label>
                                <input type="text" id="m2Phone" name="m2Phone" class="form-control"  th:value=${user.m2Phone}>
                              </div>

                              <div class="form-group col-md-6">
                                <label>家属关系</label>
                                <select th:field="${user.m2Relate}" class="form-control" name="m2Relate" id="m2Relate">
                                  <option th:selected="${user.m2Relate=='父子'}" value="父子">父子</option>
                                  <option th:selected="${user.m2Relate=='母子'}" value="母子">母子</option>
                                  <option th:selected="${user.m2Relate=='祖孙'}" value="祖孙">祖孙</option>
                                </select>
                              </div>
                            </div>


                          </div>


                        </div>





                      </div>
                    </div>
                  </form>
          </div>
        </div>
      </section>
        </div>
      </div>

    </div>
  </div>
</div>

<div th:insert="adend.html"></div>


</body>

<script>



  $(function () {
    $("#ms1View").click(function () {
      if($('#firstMenu').is(':hidden')){
        $("#firstMenu").show();
        if($('#ms2View').is(':hidden')){
          $("#ms2View").show();
        }else {
          $("#ms2View").hide();
        }

      }else{
        $("#firstMenu").hide();
        $("#ms2View").hide();
      }
    });
  })

  $(function () {
    $("#ms2View").click(function () {
      if($('#secondMenu').is(':hidden')){
        $("#secondMenu").show();
      }else{
        $("#secondMenu").hide();
      }
    });
  })



/*  $('input[name="birthday"]').daterangepicker({
    singleDatePicker:true,
    format:"yyyy-MM-dd"
  });*/


var inputsData;
var textareasData;
var selectsData


    function initFileds() {
      var inputs = document.getElementsByTagName("input");
      var textareas = document.getElementsByTagName("textarea");
      var selects = document.getElementsByTagName("select");




      inputsData = new Array(inputs.length);
      for (var i=0;i<inputs.length;i++) {
        inputsData[i] = inputs[i].value;
        if (inputs[i].type=="radio") {
          inputsData[i]=inputs[i].checked;
        }
      }

      textareasData = new Array(textareas.length);
      for (var i=0;i<textareas.length;i++) {
        textareasData[i] = textareas[i].value;
      }
      selectsData = new Array(selects.length);
      for (var i=0;i<selects.length;i++) {
        selectsData[i] = selects[i].value;
      }


    }

    function checking(){
      setInterval(checkModification,1000);
    }
  function checkModification() {
    var inputs = document.getElementsByTagName("input");
    var textareas = document.getElementsByTagName("textarea");
    var selects = document.getElementsByTagName("select");

    var hasBeenChanged = false;
    for (var i=0;i<inputs.length;i++) {
      if (inputs[i].type=="radio"&&(inputs[i].checked!=inputsData[i])) {
        hasBeenChanged = true;
        submitUser();
        window.location.reload();
        inputsData[i]=inputs[i].checked;
      }
      if (inputs[i].type!="radio"&&inputsData[i]!=inputs[i].value) {
        if(inputs[i].name!="actionType"){
          hasBeenChanged = true;
        }
        inputsData[i]=inputs[i].value;
      }
    }
    for (var i=0;i<textareas.length;i++) {
      if (textareasData[i]!=textareas[i].value) {
        hasBeenChanged = true;
        textareasData[i]=textareas[i].value;
      }
    }


    for (var i=0;i<selects.length;i++) {
      if (selectsData[i]!=selects[i].value) {
        hasBeenChanged = true;
        selectsData[i]=selects[i].value;
      }
    }
    if (hasBeenChanged) {
      submitUser();
    }
  }


  function submitUser(){
    $.ajax({
      url:"/stumanage/do_userupdate2",
      type:"POST",
      async:false,
      data:$("#userForm").serialize(),
      success:function(data){
        var result = data.data;

        if(data.code != 0){
          //window.location.href="/order_info.htm?orderId="+data.data.id;

        }else{


        }
      },
      error:function(){
        layer.msg("客户端请求有误");
      }
    });
  }


  Date.prototype.format = function (format) {
    var args = {
      "M+": this.getMonth() + 1,
      "d+": this.getDate(),
      "h+": this.getHours(),
      "m+": this.getMinutes(),
      "s+": this.getSeconds(),
    };
    if (/(y+)/.test(format))
      format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
    for (var i in args) {
      var n = args[i];
      if (new RegExp("(" + i + ")").test(format))
        format = format.replace(RegExp.$1, RegExp.$1.length == 1 ? n : ("00" + n).substr(("" + n).length));
    }
    return format;
  };



</script>
</html>